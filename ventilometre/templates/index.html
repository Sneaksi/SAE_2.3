<!DOCTYPE html>
<html lang="fr"> <!-- Sp√©cifie que le contenu est en fran√ßais pour les moteurs de recherche et lecteurs d‚Äô√©cran -->

<head>
    <meta charset="UTF-8"> <!-- Encodage UTF-8 pour supporter les caract√®res sp√©ciaux comme les accents -->
    <title>Ventilom√®tre des √âtudiants</title> <!-- Titre qui appara√Æt dans l‚Äôonglet du navigateur -->

    <!-- D√©but de la feuille de style interne -->
    <style>
        body {
            font-family: 'Segoe UI', sans-serif; /* Police moderne et lisible */
            background-color: #eef2f7; /* Couleur de fond douce pour le confort visuel */
            margin: 0; /* Supprime la marge par d√©faut du navigateur */
            padding: 2rem; /* Ajoute de l‚Äôespace int√©rieur autour du contenu */
            display: flex;
            flex-direction: column; /* Organisation verticale du contenu */
            align-items: center; /* Centrage horizontal du contenu */
        }

        h1 {
            color: #1e3a8a; /* Titre en bleu fonc√© */
            text-align: center;
        }

        .logo {
            font-size: 40px; /* Taille du logo üåÄ */
        }

        form {
            margin-top: 2rem;
            display: flex;
            flex-direction: row; /* Les √©l√©ments du formulaire sont align√©s horizontalement */
            gap: 10px; /* Espacement entre les champs */
        }

        input[type=text] {
            padding: 10px;
            width: 300px; /* Largeur fixe du champ de recherche */
            border-radius: 6px;
            border: 1px solid #ccc; /* Bordure grise claire */
        }

        button {
            padding: 10px 20px;
            background-color: #1e40af; /* Bleu vif pour se d√©marquer */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer; /* Change le curseur en main au survol */
        }

        .students-link {
            margin-top: 1.5rem;
            text-align: center;
        }

        .students-link a {
            color: #3b3b5c;
            text-decoration: none; /* Pas de soulignement de base */
            font-weight: bold;
        }

        .students-link a:hover {
            text-decoration: underline; /* Apparition du soulignement au survol */
        }

        .result, .history {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            width: 80%; /* S‚Äôadapte √† l‚Äô√©cran jusqu‚Äô√† 800px */
            max-width: 800px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); /* L√©g√®re ombre pour d√©tacher le bloc visuellement */
        }

        .vent-median {
            margin-top: 10px;
            font-size: 1.1rem;
            color: #1e3a8a;
            background-color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        ul {
            list-style-type: none; /* Supprime les puces de la liste */
            padding-left: 0;
        }

        li {
            margin: 5px 0;
        }

        .btn-clear {
            margin-top: 10px;
            background-color: #c0392b; /* Rouge pour montrer que l‚Äôaction est risqu√©e/supprime des donn√©es */
        }
    </style>
</head>

<body>
    <!-- Logo emoji affich√© en haut -->
    <div class="logo">üåÄ</div>

    <!-- Titre principal de la page -->
    <h1> Ventilom√®tre des √âtudiants </h1>

    <!-- Bloc conditionnel : affich√© seulement si une valeur collective de vent est disponible -->
    {% if vent_collectif %}
    <div class="vent-median">
        üåç Ventilom√®tre collectif du jour : <strong>{{ vent_collectif }} m/s</strong>
    </div>
    {% endif %}

    <!-- Formulaire de recherche d‚Äôun √©tudiant par son nom -->
    <form method="POST"> <!-- Les donn√©es sont envoy√©es au serveur en POST -->
        <input type="text" name="nom" placeholder="Nom de l'√©tudiant" required> <!-- Champ de saisie obligatoire -->
        <button type="submit">üîé Rechercher</button> <!-- Bouton avec emoji loupe -->
    </form>

    <!-- Lien vers la page listant tous les √©tudiants -->
    <div class="students-link">
        <p>üìÑ <a href="{{ url_for('etudiants') }}">Voir tous les √©tudiants</a></p>
    </div>

    <!-- Affiche le r√©sultat de la recherche si un √©tudiant est trouv√© -->
    {% if result %}
    <div class="result">
        <h2>R√©sultat pour {{ result.nom }} {{ result.prenom }}</h2>
        <p>üìç R√©sidence principale : {{ result.ville1 }} ‚Äî Vent : {{ result.vent1 }} m/s</p>

        <!-- R√©sidence secondaire, seulement si elle est d√©finie -->
        {% if result.ville2 %}
        <p>üè† R√©sidence secondaire : {{ result.ville2 }} ‚Äî Vent : {{ result.vent2 }} m/s</p>
        {% endif %}
    </div>
    {% endif %}

    <!-- Historique personnel : les recherches effectu√©es par l‚Äôutilisateur courant -->
    {% if historique_utilisateur %}
    <div class="history">
        <h2>üïí Historique personnel</h2>
        <ul>
            {% for h in historique_utilisateur %}
            <li>
                {{ h[6] }} ‚Äì <strong>{{ h[1] }} {{ result.prenom }}</strong> :
                {{ h[2] }} ({{ h[3] }} m/s)
                {% if h[4] %}/ {{ h[4] }} ({{ h[5] }} m/s){% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Historique global : toutes les recherches concernant un √©tudiant -->
    {% if historique %}
    <div class="history">
        <h2>üßæ Historique global de {{ result.nom }} {{ result.prenom }}</h2>
        <ul>
            {% for r in historique %}
            <li>
                {{ r[6] }} ‚Äì <strong>{{ r[1] }} {{ r[7] }}</strong> :
                {{ r[2] }} ({{ r[3] }} m/s)
                {% if r[4] %}/ {{ r[4] }} ({{ r[5] }} m/s){% endif %}
            </li>
            {% endfor %}
        </ul>

        <form method="POST" action="{{ url_for('clear_history') }}">
            <input type="hidden" name="nom" value="{{ result.nom }}">
            <input type="hidden" name="prenom" value="{{ result.prenom }}">
            <button class="btn-clear">üóëÔ∏è Vider l'historique</button>
        </form>
        
</div>

    {% endif %}

    <script>
        // Quand on clique sur le bouton "Vider l'historique"
        document.querySelector("form[action='/clear']")?.addEventListener("submit", function (e) {
            e.preventDefault(); // Emp√™che le rechargement de la page
            const historyBlock = this.closest(".history");
            if (historyBlock) {
                historyBlock.remove(); // Supprime visuellement le bloc
            }
        });
    </script>
    
</body>
</html>